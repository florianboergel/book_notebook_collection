
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Attempt handling &#8212; IOW Notebook Collection</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Default processing of raw output" href="automatic_postprocessing.html" />
    <link rel="prev" title="Git - How-to" href="../git_tutorial/git_start_v2.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/iow.jpg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">IOW Notebook Collection</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro.html">
   IOW collection of Jupyter notebooks
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  notebook_collection.ipynb
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../notebook_collection.html">
   IOW collection of Jupyter notebooks
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  accessing_data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../accessing_data/accessing_data.html">
   Accessing data from remote or local sources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../accessing_data/sealevel_emodnet/index.html">
   Accessing EMODNET sea level data from tide gauges
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  converting_files
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../converting_files/converting_files.html">
   Converting files
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../converting_files/shapefile_ascii_polygons/shapefile_ascii_polygons.html">
   Converting shapefiles (.shp) to ASCII (coordinates of polygons)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../converting_files/shapefile_nc_raster/shapefile_nc_raster.html">
   Converting shapefiles (.shp) to gridded/rastered NetCDF (.nc)
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  getm_prepare
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../getm_prepare/index.html">
   GETM preprocessing
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  git_tutorial
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../git_tutorial/Untitled.html">
   Git - How-to
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../git_tutorial/git_start_v2.html">
   Git - How-to
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  iow_esm
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Attempt handling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="automatic_postprocessing.html">
   Default processing of raw output
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="create_postprocess_task.html">
   Create a new postprocess task
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  jupyter_notebooks
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../jupyter_notebooks/jupyter_notebooks.html">
   What is an .ipynb File?
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  mom5_postprocess
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../mom5_postprocess/index.html">
   MOM5 output postprocessing
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  mom5_prepare
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../mom5_prepare/00_download_code_and_compile.html">
   Downloading MOM code and compiling
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  obsdata_gaugedata
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../obsdata_gaugedata/obsdata_gaugedata.html">
   Processing tide gauge observational data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../obsdata_gaugedata/convert_emodnet_validator/convert_emodnet_validator.html">
   Convert EmodNet tide gauge data to validator format
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../obsdata_gaugedata/find_stations/find_stations.html">
   Finding stations with most data / longest time coverage
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  obsdata_hydrography
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../obsdata_hydrography/obsdata_hydrography.html">
   Processing hydrographic observational data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../obsdata_hydrography/find_stations/find_stations.html">
   Finding stations with most data / longest time coverage
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  plots_and_maps
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../plots_and_maps/plots.html">
   Plots and maps
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../plots_and_maps/plots_and_maps.html">
   Plots and maps
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../plots_and_maps/basic_plotting/basic_plotting.html">
   Basic plotting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../plots_and_maps/map_with_countries/map_with_countries.html">
   Map with country borders
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  stat_timeseries
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../stat_timeseries/stat_timeseries.html">
   Time series analyses
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../stat_timeseries/regression_maps/regression.html">
   AMO example
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../stat_timeseries/seasonal_observation_bias/seasonal_observation_bias.html">
   Removing seasonal observation bias from an irregular time series
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/notebook_collection/iow_esm/attempt_handling.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/florianboergel/book_notebook_collection"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/florianboergel/book_notebook_collection/issues/new?title=Issue%20on%20page%20%2Fnotebook_collection/iow_esm/attempt_handling.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/florianboergel/book_notebook_collection/master?urlpath=tree/notebook_collection/iow_esm/attempt_handling.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#set-up-the-iow-esm-framework">
   1. Set up the IOW ESM framework
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-your-own-attempt-handler">
   2. Create your own attempt handler
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#register-your-attempt-handler">
   3. Register your attempt handler
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-the-iow-esm-calls-the-attempt-handler">
   4. How the IOW ESM calls the attempt handler
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-default-case">
     The default case
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Attempt handling</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#set-up-the-iow-esm-framework">
   1. Set up the IOW ESM framework
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-your-own-attempt-handler">
   2. Create your own attempt handler
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#register-your-attempt-handler">
   3. Register your attempt handler
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-the-iow-esm-calls-the-attempt-handler">
   4. How the IOW ESM calls the attempt handler
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-default-case">
     The default case
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="attempt-handling">
<h1>Attempt handling<a class="headerlink" href="#attempt-handling" title="Permalink to this headline">¶</a></h1>
<div class="section" id="set-up-the-iow-esm-framework">
<h2>1. Set up the IOW ESM framework<a class="headerlink" href="#set-up-the-iow-esm-framework" title="Permalink to this headline">¶</a></h2>
<p>Follow the steps described in the Readme you can find at the project’s <a class="reference external" href="https://git.io-warnemuende.de/iow_esm/main">main site</a>.</p>
<p>After you have set up everything go to the target machine.</p>
</div>
<div class="section" id="create-your-own-attempt-handler">
<h2>2. Create your own attempt handler<a class="headerlink" href="#create-your-own-attempt-handler" title="Permalink to this headline">¶</a></h2>
<p>Once you are on the target you have to create a python module, let’s call it <code class="docutils literal notranslate"><span class="pre">my_attempt_handling.py</span></code>.
You can create it anywhere you like but let’s assume for this example that you create it in the path to the root directory of the IOW ESM, say <code class="docutils literal notranslate"><span class="pre">&quot;/path/to/IOW_ESM&quot;</span></code>.</p>
<p>This module has to contain a class with some mandatory members and methods as illustrated in the following example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># imports for this example, you can import arbitrary modules here</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">glob</span>

<span class="c1"># class name is arbitrary</span>
<span class="k">class</span> <span class="nc">MyAttemptHandler</span><span class="p">():</span>
    
        <span class="c1"># constructor can have arbitrary arguments</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">):</span>
                <span class="c1"># !!! mandatory member attempts must be a list of strings</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">attempts</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">]</span>
                <span class="c1"># !!! mandatory member last_attempt_file must be a name of a file (can be a path, absolute or relative to &quot;/path/to/IOW_ESM/scripts/run&quot;) that can be created and read</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">last_attempt_file</span> <span class="o">=</span> <span class="s2">&quot;my_last_attempt.txt&quot;</span>

                <span class="c1"># optional arguments and members</span>
                <span class="c1"># it makes sense to memorize the root directory</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>

        <span class="c1"># !!! mandatory method for preparing an attempt, signature is obligatory</span>
        <span class="k">def</span> <span class="nf">prepare_attempt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attempt</span><span class="p">):</span>

                <span class="k">if</span> <span class="n">attempt</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">attempts</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="c1"># do nothing for the first attempt</span>
                        <span class="k">return</span>

                <span class="k">if</span> <span class="n">attempt</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">attempts</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="c1"># do something with input files for second attempt</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;touch &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;/attempt2.txt&quot;</span><span class="p">)</span>
                        <span class="k">return</span>

                <span class="k">return</span>

        <span class="c1"># !!! mandatory method for evaluating an attempt, signature is obligatory, must return True or False</span>
        <span class="k">def</span> <span class="nf">evaluate_attempt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attempt</span><span class="p">):</span>

                <span class="c1"># in this example let&#39;s provoke that the first attempt fails</span>
                <span class="k">if</span> <span class="n">attempt</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">attempts</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="k">return</span> <span class="kc">False</span>

                <span class="c1"># let the second attempt succeed if file from preparation has been created</span>
                <span class="k">if</span> <span class="n">attempt</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">attempts</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;/attempt2.txt&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="p">[]:</span>
                                <span class="k">return</span> <span class="kc">True</span>

                <span class="k">return</span> <span class="kc">True</span>
</pre></div>
</div>
<p>Read the comments in this code and understand what is happening.
This dummy example handles two attempts called <code class="docutils literal notranslate"><span class="pre">&quot;1&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;2&quot;</span></code>, see member <code class="docutils literal notranslate"><span class="pre">attempts</span></code>.
While creation, the object gets an additional member for memorizing the root path of the project.
However you can pass arbitrary arguments to the constructor.
The example class does nothing to prepare the first attempt but creates an empty file for the second attempt, see the <code class="docutils literal notranslate"><span class="pre">prepare_attempt</span></code> method.
It is further constructed such that the first attempt will always fail and the second succeeds only if the empty file has been created, <code class="docutils literal notranslate"><span class="pre">evaluate_attempt</span></code> method.</p>
<p>Of course for your application you have to implement your own functionality according to your needs.</p>
</div>
<div class="section" id="register-your-attempt-handler">
<h2>3. Register your attempt handler<a class="headerlink" href="#register-your-attempt-handler" title="Permalink to this headline">¶</a></h2>
<p>In order to register your attempt handler you have to pass an instance via the <code class="docutils literal notranslate"><span class="pre">global_settings.py</span></code> in the <code class="docutils literal notranslate"><span class="pre">input</span></code> folder within your <code class="docutils literal notranslate"><span class="pre">&quot;/path/to/IOW_ESM&quot;</span></code>.
For the example given above you would have to add the following lines to the <code class="docutils literal notranslate"><span class="pre">global_settings.py</span></code> file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#################################################</span>
<span class="c1"># STEP 3a: Attempt handling                     #</span>
<span class="c1">#################################################</span>

<span class="c1"># import own module </span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;/path/to/IOW_ESM&quot;</span><span class="p">)</span> <span class="c1"># you can put absolute paths here, if not this path is interpreted relative to scripts/run </span>
<span class="kn">import</span> <span class="nn">my_attempt_handling</span>

<span class="c1"># create instance of the attempt handler</span>
<span class="n">attempt_handler</span> <span class="o">=</span> <span class="n">my_attempt_handling</span><span class="o">.</span><span class="n">MyAttemptHandler</span><span class="p">(</span><span class="s2">&quot;/path/to/IOW_ESM&quot;</span><span class="p">)</span>                      <span class="c1"># if a run fails, you can have new attempts with modified settings</span>

</pre></div>
</div>
<p>Again the name <code class="docutils literal notranslate"><span class="pre">my_attempt_handling</span></code>, <code class="docutils literal notranslate"><span class="pre">MyAttemptHandler</span></code> as well as the path <code class="docutils literal notranslate"><span class="pre">&quot;/path/to/IOW_ESM&quot;</span></code> might be different for you.</p>
</div>
<div class="section" id="how-the-iow-esm-calls-the-attempt-handler">
<h2>4. How the IOW ESM calls the attempt handler<a class="headerlink" href="#how-the-iow-esm-calls-the-attempt-handler" title="Permalink to this headline">¶</a></h2>
<p>The IOW ESM will call the attempt handler such that it iterates over the entries in <code class="docutils literal notranslate"><span class="pre">attempt_handler.attempts</span></code> until the model does not crash and <code class="docutils literal notranslate"><span class="pre">evaluate_attempt</span></code> returns <code class="docutils literal notranslate"><span class="pre">True</span></code>, or the last attempt is exhausted.</p>
<p>The corresponding code from <code class="docutils literal notranslate"><span class="pre">scripts/run/run.py</span></code> looks like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">runs_per_job</span><span class="p">):</span>
        
    <span class="c1"># get next attempt from the file specified in member last_attempt_file (done by an attempt_iterator object)</span>
    <span class="n">attempt</span> <span class="o">=</span> <span class="n">attempt_iterator</span><span class="o">.</span><span class="n">get_next_attempt</span><span class="p">()</span>

    <span class="c1"># prepare the attempt</span>
    <span class="n">attempt_handler</span><span class="o">.</span><span class="n">prepare_attempt</span><span class="p">(</span><span class="n">attempt</span><span class="p">)</span>

    <span class="c1"># perform attempt</span>
    <span class="c1"># ...</span>
    <span class="c1"># set run_failed = True if the model crashed</span>

    <span class="c1"># if the run did not crash, still check for evaluation</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">run_failed</span><span class="p">:</span>
        <span class="n">run_failed</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">attempt_handler</span><span class="o">.</span><span class="n">evaluate_attempt</span><span class="p">(</span><span class="n">attempt</span><span class="p">)</span>
    
    <span class="c1"># something went wrong: either model has crashed or the attempt has not passed the criterion </span>
    <span class="k">if</span> <span class="n">run_failed</span><span class="p">:</span>
        <span class="c1"># if this was the final attempt, we stop here</span>
        <span class="k">if</span> <span class="n">attempt</span> <span class="o">==</span> <span class="n">attempt_handler</span><span class="o">.</span><span class="n">attempts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;IOW_ESM job finally failed integration from &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">start_date</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; to &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">end_date</span><span class="p">))</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

        <span class="c1"># if it was not the final attempt, memorize this attempt (done by an attempt_iterator object)</span>
        <span class="n">attempt_iterator</span><span class="o">.</span><span class="n">store_last_attempt</span><span class="p">(</span><span class="n">attempt</span><span class="p">)</span>
        
        <span class="c1"># go on with next attempt in a new job</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  attempt &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">attempt</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; failed. Go on with next attempt.&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;cd &quot;</span> <span class="o">+</span> <span class="n">IOW_ESM_ROOT</span> <span class="o">+</span> <span class="s2">&quot;/scripts/run; &quot;</span> <span class="o">+</span> <span class="n">resubmit_command</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

</pre></div>
</div>
<p><strong>Important</strong></p>
<ul class="simple">
<li><p>the preparation takes place <em>before</em> the input files are copied to the local work directories</p></li>
<li><p>the evaluation takes place <em>after</em> the output is copied to the global <code class="docutils literal notranslate"><span class="pre">work</span></code> directory but <em>before</em> it is stored in the <code class="docutils literal notranslate"><span class="pre">output</span></code> directory</p></li>
</ul>
<p>In other words you best prepare your attempt in the <code class="docutils literal notranslate"><span class="pre">input</span></code> directory and evaluate it in the global <code class="docutils literal notranslate"><span class="pre">work</span></code> directory.</p>
<p>Note that preparation and evaluation are intended to be rather small and fast tasks since these steps consume walltime of your job.</p>
<div class="section" id="the-default-case">
<h3>The default case<a class="headerlink" href="#the-default-case" title="Permalink to this headline">¶</a></h3>
<p>The default for the variable <code class="docutils literal notranslate"><span class="pre">attempt_handler</span></code> would be <code class="docutils literal notranslate"><span class="pre">None</span></code> or it can be left out.
In both cases there will be a single attempt for each run without preparation and always positive evaluation (however a run can of cource  still fail if the model crashes)</p>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "iow_python",
            path: "./notebook_collection/iow_esm"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'iow_python'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="../git_tutorial/git_start_v2.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Git - How-to</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="automatic_postprocessing.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Default processing of raw output</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Hagen Radtke and Florian Boergel<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>